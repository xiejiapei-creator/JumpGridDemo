{"version":3,"sources":["file:///Users/xiejiapei/Documents/3D%20Game/Jump/assets/Scipts/GameManager.ts"],"names":["_decorator","Component","Prefab","instantiate","Node","PlayerController","ccclass","property","BlockType","GameState","GameManager","type","_road","start","generateRoad","node","removeAllChildren","push","BT_STONE","i","roadLength","BT_NONE","Math","floor","random","j","length","block","spawnBlockByType","addChild","setPosition","cubePrfb"],"mappings":";;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,I,OAAAA,I;;AAC5CC,MAAAA,gB,iBAAAA,gB;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBP,U,GAE9B;;iBACKQ,S;AAAAA,QAAAA,S,CAAAA,S;AAAAA,QAAAA,S,CAAAA,S;SAAAA,S,KAAAA,S;;AAGJ,O,CAED;;iBACKC,S;AAAAA,QAAAA,S,CAAAA,S;AAAAA,QAAAA,S,CAAAA,S;AAAAA,QAAAA,S,CAAAA,S;SAAAA,S,KAAAA,S;;AAIJ;;6BAGYC,W,WADZJ,OAAO,CAAC,aAAD,C,UAIHC,QAAQ,CAAC;AAACI,QAAAA,IAAI,EAAET;AAAP,OAAD,C,UAQRK,QAAQ,CAAC;AAACI,QAAAA,IAAI;AAAA;AAAA;AAAL,OAAD,C,UAIRJ,QAAQ,CAAC;AAACI,QAAAA,IAAI,EAAEP;AAAP,OAAD,C,2BAhBb,MACaM,WADb,SACiCT,SADjC,CAC2C;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eAmB/BW,KAnB+B,GAmBV,EAnBU;AAAA;;AAqBvCC,QAAAA,KAAK,GAAI;AACL,eAAKC,YAAL;AACH,SAvBsC,CAyBvC;;;AACAA,QAAAA,YAAY,GAAG;AACX;AACA;AACA,eAAKC,IAAL,CAAUC,iBAAV,GAHW,CAKX;;AACA,eAAKJ,KAAL,GAAa,EAAb,CANW,CAOX;;AACA,eAAKA,KAAL,CAAWK,IAAX,CAAgBT,SAAS,CAACU,QAA1B,EARW,CAUX;;;AACA,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKC,UAAzB,EAAqCD,CAAC,EAAtC,EAA0C;AACtC;AACA,gBAAI,KAAKP,KAAL,CAAWO,CAAC,GAAC,CAAb,MAAoBX,SAAS,CAACa,OAAlC,EAA2C;AACvC,mBAAKT,KAAL,CAAWK,IAAX,CAAgBT,SAAS,CAACU,QAA1B;AACH,aAFD,MAEO;AACH,mBAAKN,KAAL,CAAWK,IAAX,CAAgBK,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,KAAgB,CAA3B,CAAhB;AACH;AACJ,WAlBU,CAoBX;;;AACA,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKb,KAAL,CAAWc,MAA/B,EAAuCD,CAAC,EAAxC,EAA4C;AACxC,gBAAIE,KAAK,GAAG,KAAKC,gBAAL,CAAsB,KAAKhB,KAAL,CAAWa,CAAX,CAAtB,CAAZ,CADwC,CAExC;;AACA,gBAAIE,KAAJ,EAAW;AACP,mBAAKZ,IAAL,CAAUc,QAAV,CAAmBF,KAAnB;AACAA,cAAAA,KAAK,CAACG,WAAN,CAAkBL,CAAlB,EAAqB,CAAC,GAAtB,EAA2B,CAA3B;AACH;AACJ;AACJ,SAvDsC,CAyDvC;;;AACAG,QAAAA,gBAAgB,CAACjB,IAAD,EAAkB;AAC9B,cAAI,CAAC,KAAKoB,QAAV,EAAoB;AAChB,mBAAO,IAAP;AACH;;AAED,cAAIJ,KAAkB,GAAG,IAAzB,CAL8B,CAM9B;;AACA,kBAAOhB,IAAP;AACI,iBAAKH,SAAS,CAACU,QAAf;AACIS,cAAAA,KAAK,GAAGxB,WAAW,CAAC,KAAK4B,QAAN,CAAnB;AACA;AAHR;;AAMA,iBAAOJ,KAAP;AACH;;AAxEsC,O;;;;;iBAIN,I;;qFAGhCpB,Q;;;;;iBACmB,E;;;;;;;iBAIyB,I;;;;;;;iBAIb,I","sourcesContent":["import { _decorator, Component, Prefab, instantiate, Node, CCInteger } from 'cc';\nimport { PlayerController } from './PlayerController';\nconst { ccclass, property } = _decorator;\n\n// 赛道格子类型，坑（BT_NONE）或者实路（BT_STONE）\nenum BlockType {\n    BT_NONE,\n    BT_STONE,\n};\n\n// 游戏状态\nenum GameState{\n    GS_INIT,\n    GS_PLAYING,\n    GS_END,\n};\n\n@ccclass(\"GameManager\")\nexport class GameManager extends Component {\n\n    // 赛道预制\n    @property({type: Prefab})\n    public cubePrfb: Prefab | null = null;\n\n    // 赛道长度\n    @property\n    public roadLength = 50;\n\n    // 玩家控制器\n    @property({type: PlayerController})\n    public playerCtrl: PlayerController | null = null;\n\n    // 动态开启/关闭开始菜单\n    @property({type: Node})\n    public startMenu: Node | null = null;\n\n    // 赛道\n    private _road: BlockType[] = [];\n\n    start () {\n        this.generateRoad();\n    }\n\n    // 生成道路\n    generateRoad() {\n        // 防止游戏重新开始时，赛道还是旧的赛道\n        // 因此，需要移除旧赛道，清除旧赛道数据\n        this.node.removeAllChildren();\n\n        // 创建新的赛道\n        this._road = [];\n        // 确保游戏运行时，人物一定站在实路上\n        this._road.push(BlockType.BT_STONE);\n\n        // 确定好每一格赛道类型\n        for (let i = 1; i < this.roadLength; i++) {\n            // 如果上一格赛道是坑，那么这一格一定不能为坑\n            if (this._road[i-1] === BlockType.BT_NONE) {\n                this._road.push(BlockType.BT_STONE);\n            } else {\n                this._road.push(Math.floor(Math.random() * 2));\n            }\n        }\n\n        // 根据赛道类型生成赛道\n        for (let j = 0; j < this._road.length; j++) {\n            let block = this.spawnBlockByType(this._road[j]);\n            // 判断是否生成了道路，因为 spawnBlockByType 有可能返回坑（值为 null）\n            if (block) {\n                this.node.addChild(block);\n                block.setPosition(j, -1.5, 0);\n            }\n        }\n    }\n\n    // 通过砖块类型生成相应砖块\n    spawnBlockByType(type: BlockType) {\n        if (!this.cubePrfb) {\n            return null;\n        }\n\n        let block: Node | null = null;\n        // 赛道类型为实路才生成\n        switch(type) {\n            case BlockType.BT_STONE:\n                block = instantiate(this.cubePrfb);\n                break;\n        }\n\n        return block;\n    }\n}"]}